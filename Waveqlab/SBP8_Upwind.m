%8th order

m=70; %problemstorlek
%h=1/(m-1);
h=1;
   
x=linspace(0,1,m);x=x';

x0=x.^0/factorial(1); 
x1=x.^1/factorial(1);
x2=x.^2/factorial(2);
x3=x.^3/factorial(3);
x4=x.^4/factorial(4);
x5=x.^5/factorial(5);
x6=x.^6/factorial(6);
x7=x.^7/factorial(7);
x8=x.^8/factorial(8);
x9=x.^9/factorial(9);
x10=x.^10/factorial(10);
x11=x.^11/factorial(11);
x12=x.^12/factorial(12);
x13=x.^13/factorial(13);
x14=x.^14/factorial(14);
x15=x.^15/factorial(15);
c=ones(m,1);

%The coefficients in the norm are given by

H_diag = ones(8,1);

H_diag(1) = 7489399/25401600;
H_diag(2) = 5537831/3628800;
H_diag(3) = 103373/403200;
H_diag(4) = 261259/145152;
H_diag(5) = 298231/725760;
H_diag(6) = 515917/403200;
H_diag(7) = 3349159/3628800;
H_diag(8) = 25639991/25401600;

H_diag1 = diag(H_diag);
H_diag2 = diag(flipud(H_diag));

H 				=	diag(ones(m,1),0);
H(1:8,1:8)		=	H_diag1;
H(m-7:m,m-7:m)	=	H_diag2;
H 				= 	H*h;
HI 				= 	inv(H);


Qp = diag(zeros(m,1));

Qp_c_stencil = [-1/168  +1/14  -1/2 -9/20  +5/4 -1/2  +1/6 -1/28 +1/280];

Qm_c_stencil = -fliplr(Qp_c_stencil);

!rats(Qp_c_stencil)
!rats(Qm_c_stencil)


Qp = - 1/168 	* diag(ones(m-3,1),-3)...
	 + 1/14 	* diag(ones(m-2,1),-2)...
	 - 1/2 		* diag(ones(m-1,1),-1)...
	 - 9/20 	* diag(ones(m  ,1),0)...
	 + 5/4 		* diag(ones(m-1,1),1)...
	 - 1/2 		* diag(ones(m-2,1),2)...
	 + 1/6 		* diag(ones(m-3,1),3)...
	 - 1/28 	* diag(ones(m-4,1),4)...
	 + 1/280 	* diag(ones(m-5,1),5);


%The coefficients in Q + are given by

Q_U = diag(zeros(8,1));

Q_U(1, 1) = - 16683/63018560;
Q_U(1, 2) =   29345822969987/43354248537600;
Q_U(1, 3) = - 2734625426591/40644608004000;
Q_U(1, 4) = - 113480208109603/780376473676800;
Q_U(1, 5) = - 830250230261/26012549122560;
Q_U(1, 6) =   2500519492033/32515686403200;
Q_U(1, 7) =   2235718279643/390188236838400;
Q_U(1, 8) = - 388481888477/26543417472000;
Q_U(2, 1) = - 29227665839987/43354248537600;
Q_U(2, 2) = - 493793/63018560;
Q_U(2, 3) =   8302717120817/26543417472000;
Q_U(2, 4) =   3739408501537/9290196115200;
Q_U(2, 5) =   2684481534461/13935294172800;
Q_U(2, 6) = - 4450185662513/18580392230400;
Q_U(2, 7) = - 1221838279381/37160784460800;
Q_U(2, 8) =   90595000956023/1950941184192000;
Q_U(3, 1) =   2505689537591/40644608004000;
Q_U(3, 2) = - 7312922392817/26543417472000;
Q_U(3, 3) = - 69332623/1323389760;
Q_U(3, 4) =   10994933811709/18580392230400;
Q_U(3, 5) = - 9270952411151/18580392230400;
Q_U(3, 6) =   3191238635141/20644880256000;
Q_U(3, 7) =   4442211176987/92901961152000;
Q_U(3, 8) = - 940661365031/32515686403200;
Q_U(4, 1) =   118016946570403/780376473676800;
Q_U(4, 2) = - 4173878828737/9290196115200;
Q_U(4, 3) = - 7990503962509/18580392230400;
Q_U(4, 4) = - 207799621/1323389760;
Q_U(4, 5) =   2044021560341/2477385630720;
Q_U(4, 6) =   511197701761/18580392230400;
Q_U(4, 7) =   1237681717213/13935294172800;
Q_U(4, 8) = - 7784834666617/130062745612800;
Q_U(5, 1) =   68609076271/2364777192960;
Q_U(5, 2) = - 2235651762161/13935294172800;
Q_U(5, 3) =   6527681584751/18580392230400;
Q_U(5, 4) = - 1115980068821/2477385630720;
Q_U(5, 5) = - 55386253/189055680;
Q_U(5, 6) =   3208334350649/3716078446080;
Q_U(5, 7) = - 407569013461/844563283200;
Q_U(5, 8) =   136474842626653/780376473676800;
Q_U(6, 1) = - 2487637785013/32515686403200;
Q_U(6, 2) =   4244231077313/18580392230400;
Q_U(6, 3) = - 1550378843141/20644880256000;
Q_U(6, 4) = - 5726967564961/18580392230400;
Q_U(6, 5) = - 1017898941929/3716078446080;
Q_U(6, 6) = - 526653889/1323389760;
Q_U(6, 7) =   45241297077547/37160784460800;
Q_U(6, 8) = - 2279608411897/5080576000500;
Q_U(7, 1) = - 2164019088443/390188236838400;
Q_U(7, 2) =   1263196075861/37160784460800;
Q_U(7, 3) = - 6600697610987/92901961152000;
Q_U(7, 4) =   556610591687/13935294172800;
Q_U(7, 5) =   926842346471/9290196115200;
Q_U(7, 6) = - 18757693936747/37160784460800;
Q_U(7, 7) = - 584765899/1323389760;
Q_U(7, 8) =   204646287449/168431424000;
Q_U(8, 1) =   387091928477/26543417472000;
Q_U(8, 2) = - 90231551688023/1950941184192000;
Q_U(8, 3) =   1032404418251/32515686403200;
Q_U(8, 4) =   3502353445417/130062745612800;
Q_U(8, 5) = - 15385068876253/780376473676800;
Q_U(8, 6) =   262499068919/10161152001000;
Q_U(8, 7) = - 867004691939/1852745664000;
Q_U(8, 8) = - 85017967/189055680;

Qp(1:8,1:8) 	=	Q_U;
Qp(m-7:m,m-7:m) =	flipud( fliplr(Q_U ) )';

Qm=-Qp';

e_1=zeros(m,1);e_1(1)=1;
e_m=zeros(m,1);e_m(m)=1;

Dp=HI*(Qp-1/2*e_1*e_1'+1/2*e_m*e_m') ;

Dm=HI*(Qm-1/2*e_1*e_1'+1/2*e_m*e_m') ;

%Dp'*H + H*Dm
% 
% for i = 1:15
%     
%     figure(i);
%     
%     eval('plot(x,Dp*(x'+string(i)+'))')
%     
%     hold on 
%     
%     eval('plot(x,Dm*(x'+string(i)+'))')
%     
%     hold on
%     
%     eval('plot(x,x'+string(i-1)+')')
%     
%     hold on
%    
% end 

diary('8th_order_fortran.txt');
WQLABSTENCILCONVERT_X
WQLABSTENCILCONVERT_Y
WQLABSTENCILCONVERT_Z
diary('off');
